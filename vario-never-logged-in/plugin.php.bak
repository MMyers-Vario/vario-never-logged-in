<?php
/*
Plugin Name: Vario Never Logged In
Plugin URI: https://virtualbyvario.com
Description: Sets a User Role (Never Logged In) for new users, which is removed once the user logs in.
Version: 1.05
Author: Virtual by Vario
Author URI: https://virtualbyvario.com
*/


// Create a new user role
function nli_new_role() {  
 
    //add the new user role
    add_role(
        'never_logged_in',
        'Never Logged In',
        array()
    );
 
}
add_action('admin_init', 'nli_new_role');
 

add_filter('pre_option_default_role', function($default_role){
    return 'never_logged_in';
    return $default_role;
});

function vario_remove_nli( $user_login, $user ) {
  
    //When this user logs in, check if user has never logged in
    if (in_array("never_logged_in", $user->roles)) {
        //remove the Never Logged In user role if they have it
		remove_role( 'never_logged_in' );
    }
}
add_action('wp_login', 'vario_remove_nli', 10, 2);


?>